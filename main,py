#!/usr/bin/env python
import sys
import yaml
import importlib

class StepData (object):
    def __init__(self,module_name, config_name):
        self.module_name = module_name
        self.config_name = config_name
    def result(self):
        config_file = CONFIG_DIRECTORY+self.config_name+".yml"
        module = importlib.import_module('modules.'+self.module_name)
        return module.main(config_file)

CONFIG_DIRECTORY = "./config/"
HEALTCH_PROCCESS_CONFIG = CONFIG_DIRECTORY+"Healthcheck.yml"

config_file_load = open(HEALTCH_PROCCESS_CONFIG,'r')
config = yaml.safe_load(config_file_load)

for _iterator in range(len(config["tasks"])):
    for _iterator2 in range(len(config["tasks"][_iterator]["steps"])):

        print "Esta es la informacion de la tarea " + config["tasks"][_iterator]["name"] + " el paso "  + config["tasks"][_iterator]["steps"][_iterator2]["name"] + " con el modulo " + config["tasks"][_iterator]["steps"][_iterator2]["module"]

        valor = StepData(config["tasks"][_iterator]["steps"][_iterator2]["module"],config["tasks"][_iterator]["steps"][_iterator2]["name"])
        print valor.result()[0]

        del valor
